<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hypersmart.usercenter.mapper.UcOrgUserMapper">

    <resultMap id="UcOrgUser" type="com.hypersmart.usercenter.model.UcOrgUser">
        <id jdbcType="VARCHAR" property="id" column="ID_"></id>
        <result column="ORG_ID_" jdbcType="VARCHAR" property="orgId"></result>
        <result column="USER_ID_" jdbcType="VARCHAR" property="userId"></result>
    </resultMap>

    <sql id="BaseAttribute">
        ID_,ORG_ID_,USER_ID_
    </sql>
    <sql id="BaseTable">
        uc_org_user
    </sql>

    <select id="getUserOrg" resultMap="UcOrgUser">
        select
        <include refid="BaseAttribute"/>
        from
        <include refid="BaseTable"/>
        where USER_ID_ = #{userId}
    </select>

    <select id="getPostIdByjobCode" resultType="java.lang.String">
        select p.ID_
        from uc_org_post p
        join  uc_org_job j on p.JOB_ID_ = j.ID_
        where j.CODE_ = #{code}
    </select>

    <select id="quertList" parameterType="java.util.Map" resultType="java.util.Map">
        SELECT * from (
        select u.ID_ as houseKeeperId,
        uou.ID_ as id,
        u.FULLNAME_ as fullName,u.MOBILE_ mobile,u.ACCOUNT_ as account,post.ID_ as `postId`,post.POS_NAME_ as posName,
        org_lv4.NAME_ as area,
        org_lv3.NAME_ as project,
        org_lv2.NAME_ as plot,
        org.NAME_ as divide,
        org_lv4.ID_ as areaId,
        org_lv3.ID_ as projectId,
        org_lv2.ID_ as plotId,
        org.ID_ as divideId
        from uc_user u
        join uc_org_user uou on u.ID_ = uou.USER_ID_
        join uc_org org on uou.ORG_ID_ = org.ID_
        join uc_org org_lv2 on org.PARENT_ID_ = org_lv2.ID_
        join uc_org org_lv3 on org_lv2.PARENT_ID_ = org_lv3.ID_
        join uc_org org_lv4 on org_lv3.PARENT_ID_ = org_lv4.ID_
        join uc_org_post post on uou.POS_ID_ =  post.ID_ ) a
        <where>
            <if test="whereSql!=null">
                ${whereSql}
            </if>
        </where>
        <if test="orderBySql!=null">
            ORDER BY ${orderBySql}
        </if>
    </select>

</mapper>