<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hypersmart.usercenter.mapper.UcOrgUserMapper">

    <resultMap id="UcOrgUser" type="com.hypersmart.usercenter.model.UcOrgUser">
        <id jdbcType="VARCHAR" property="id" column="ID_"></id>
        <result column="ORG_ID_" jdbcType="VARCHAR" property="orgId"></result>
        <result column="USER_ID_" jdbcType="VARCHAR" property="userId"></result>
    </resultMap>

    <sql id="BaseAttribute">
        ID_,ORG_ID_,USER_ID_
    </sql>
    <sql id="BaseTable">
        uc_org_user
    </sql>

    <select id="getUserOrg" resultMap="UcOrgUser">
        select
        <include refid="BaseAttribute"/>
        from
        <include refid="BaseTable"/>
        where USER_ID_ = #{userId}
        and  IS_DELE_ = 0
    </select>

    <!--<select id="getUserIdOrgByOrgIds" resultMap="java.lang.String">-->
        <!--select-->
        <!--ID_-->
        <!--from-->
        <!--<include refid="BaseTable"/>-->
        <!--where IS_DELE_ = 0 AND ORG_ID_  in  #{userId}-->
        <!--<foreach collection="list" index="index" item="item" open="(" separator="," close=")">-->
                <!--#{item}-->
        <!--</foreach>-->
    <!--</select>-->

    <select id="getPostIdByjobCode" resultType="java.lang.String">
        select p.ID_
        from uc_org_post p
        join  uc_org_job j on p.JOB_ID_ = j.ID_
        where j.CODE_ = #{code}
    </select>

    <!--查询用户默认维度组织-->
    <select id="getUserDefaultOrg" resultMap="UcOrgUser">
         select
        u.ID_, u.ORG_ID_,u.USER_ID_
        from uc_org_user u
        INNER JOIN  uc_org o on u.ORG_ID_=o.ID_
				INNER JOIN uc_demension d on d.ID_=o.DEM_ID_
        where u.USER_ID_ =#{userId} and d.IS_DEFAULT_=1
        and  u.IS_DELE_ !=1 and o.IS_DELE_ !=1 and d.IS_DELE_!=1
    </select>

    <!--查询用户非默认维度组织且层级为地块，项目的关联默认组织-->
    <select id="getUserDefaultOrgByRef" resultMap="UcOrgUser">
      select distinct
        o.REF_ID_ as ORG_ID_ ,u.USER_ID_
        from uc_org_user u
        INNER JOIN  uc_org o on u.ORG_ID_=o.ID_
				INNER JOIN uc_demension d on d.ID_=o.DEM_ID_
        where u.USER_ID_ =#{userId} and d.IS_DEFAULT_!=1 and (o.GRADE_='LINE_DIKUAI' || o.GRADE_='LINE_PROJECT' )
        and  u.IS_DELE_ !=1 and o.IS_DELE_ !=1 and d.IS_DELE_!=1

    </select>

    <select id="getOrgByCondition" resultType="java.util.Map">
        select * from uc_org
        <where>
            IS_DELE_='0' and PATH_ LIKE CONCAT('%', #{sy}, '%')
            <if test="whereSql">
                and ${whereSql}
            </if>
            <if test="orderSql">
                order by ${orderSql}
            </if>
        </where>
    </select>

    <select id="getListByOrgIdUserId" resultType="com.hypersmart.usercenter.model.UcOrgUser">
        select 	ID_ as id, ORG_ID_ as orgId, USER_ID_ as userId, IS_MASTER_ as isMaster, POS_ID_ as posId,
        IS_CHARGE_ as isCharge, START_DATE_ as startDate, END_DATE_ as endDate,
        IS_REL_ACTIVE_ as isRelActive, UPDATE_TIME_ as updateTime, IS_DELE_, VERSION_ as version
        from uc_org_user
        <where>
            <if test="orgId!=null and orgId!=''">
                ORG_ID_=#{orgId}
            </if>
            <if test="userId!=null and userId!=''">
                and USER_ID_=#{userId}
            </if>
        </where>
    </select>
</mapper>
